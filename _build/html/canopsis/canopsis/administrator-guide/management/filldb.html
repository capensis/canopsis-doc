

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data Injector &mdash; Canopsis 1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Canopsis 1.0 documentation" href="../../../../index.html"/>
        <link rel="up" title="Canopsis Management" href="index.html"/>
        <link rel="next" title="Best practices" href="../best-practices/index.html"/>
        <link rel="prev" title="Data cleaner" href="engines/datacleaner-configuration.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> Canopsis
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Canopsis</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Sakura</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../user-guide/index.html">User guide</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Administrator guide</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../archi/index.html">Canopsis Architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="../setup/index.html">Canopsis Setup</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html">Canopsis Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../best-practices/index.html">Best practices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../developer-guide/index.html">Developer guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/index.html">API</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#canopsis-specification">Canopsis Specification</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../canopsis-connectors/index.html">Canopsis Connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../canopsis-ui-bricks/index.html">Canopsis Ui Bricks</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../index.html">Canopsis</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../index.html">Canopsis</a> &raquo;</li>
      
          <li><a href="../../index.html">Sakura</a> &raquo;</li>
      
          <li><a href="../index.html">Administrator guide</a> &raquo;</li>
      
          <li><a href="index.html">Canopsis Management</a> &raquo;</li>
      
    <li>Data Injector</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../_sources/canopsis/canopsis/administrator-guide/management/filldb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data-injector">
<span id="admin-setup-filldb"></span><h1>Data Injector<a class="headerlink" href="#data-injector" title="Permalink to this headline">¶</a></h1>
<p>When canopsis is built, some documents are inserted into database. These files are the canopsis basics that make canopsis work with default parameters.
It is possible to customize how Canopsis documents are loaded, and finally, how Canopsis behaves.</p>
<div class="section" id="filldb">
<h2>filldb<a class="headerlink" href="#filldb" title="Permalink to this headline">¶</a></h2>
<p>The filldb command makes canopsis to run some python scripts located in <code class="docutils literal"><span class="pre">/opt/canopsis/opt/mongodb/load.d</span></code> in sequential order. These files contains instructions in python format on how to load default configuration into canopsis.</p>
<p>This script can be run with two parameters (logged as canopsis user):</p>
<blockquote>
<div>python ~/opt/mongodb/filldb.py <strong>init</strong> | <strong>update</strong></div></blockquote>
<p>Init parameter will erase all previous information from database, whereas update will only update the database.</p>
</div>
<div class="section" id="json-loader">
<h2>json loader<a class="headerlink" href="#json-loader" title="Permalink to this headline">¶</a></h2>
<p>The file module <code class="docutils literal"><span class="pre">11_jsonloader.py</span></code> enables to tell canopsis to load custom files into the database depending in upsert mode following below considerations:</p>
<p>The json loader script searches each folder located in the <code class="docutils literal"><span class="pre">/opt/canopsis/opt/mongodb/load.d</span></code> folder that are prefixed by <strong>json_</strong>.  Theses folders name have to be followed by a collection name that will tell where to upsert json documents. If a json document have to be upsert in the object collection, the json folder have to be called <strong>json_object</strong>.</p>
<p>Json folders to contain <strong>&lt;filename&gt;.json</strong> files that contains either a document or a list of document. These document must be identified by a special key that allow upsert. This key is named <code class="docutils literal"><span class="pre">loader_id</span></code> and must be uniq over the collection folder documents. Below a sample of a json document being inserted in the object collection because the file path is <code class="docutils literal"><span class="pre">/opt/canopsis/opt/mongodb/load.d/json_object/mydocument.json</span></code></p>
<p>in a single document:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;loader_id&quot;</span><span class="o">:</span><span class="s2">&quot;000&quot;</span><span class="p">,</span>
   <span class="s2">&quot;document_key_1&quot;</span><span class="o">:</span> <span class="s2">&quot;document_value_1&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>or in a document list:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">[</span>
   <span class="p">{</span>
      <span class="s2">&quot;loader_id&quot;</span><span class="o">:</span><span class="s2">&quot;000&quot;</span><span class="p">,</span>
      <span class="s2">&quot;document_key_2&quot;</span><span class="o">:</span> <span class="s2">&quot;document_value_2&quot;</span>
   <span class="p">},</span>
   <span class="p">{</span>
      <span class="s2">&quot;loader_id&quot;</span><span class="o">:</span><span class="s2">&quot;000&quot;</span><span class="p">,</span>
      <span class="s2">&quot;document_key_3&quot;</span><span class="o">:</span> <span class="s2">&quot;document_value_3&quot;</span>
   <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>it is possible to prevent a document for beiing updated by the json loader by adding the <code class="docutils literal"><span class="pre">loader_no_update</span></code> key equals to <strong>true</strong> in the json document.</p>
<p><strong>json loader hooks</strong></p>
<p>When the json loader is about to upsert a json document, some processing is called. The feature this brings is for example to replace a macro with a specific computed value.</p>
<blockquote>
<div><ul class="simple">
<li>Macro <code class="docutils literal"><span class="pre">[[HOSTNAME]]</span></code> will tell the server where filldb is ran to replace strings in records with the hostname value in place of the macro. for example, when the following record is processed :</li>
</ul>
</div></blockquote>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;loader_id&quot;</span><span class="o">:</span><span class="s2">&quot;000&quot;</span><span class="p">,</span>
   <span class="s2">&quot;document_key_1&quot;</span><span class="o">:</span> <span class="s2">&quot;document_value_1&quot;</span>
   <span class="s2">&quot;my_key&quot;</span> <span class="o">:</span> <span class="s2">&quot;canopsis runs on [[HOSTNAME]]&quot;</span>
   <span class="s2">&quot;my_list&quot;</span> <span class="o">:</span> <span class="p">[</span><span class="s2">&quot;canopsis runs on [[HOSTNAME]]&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Will upsert in database the following document in case <code class="docutils literal"><span class="pre">myhostname</span></code> is the server hostname:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;loader_id&quot;</span><span class="o">:</span><span class="s2">&quot;000&quot;</span><span class="p">,</span>
   <span class="s2">&quot;document_key_1&quot;</span><span class="o">:</span> <span class="s2">&quot;document_value_1&quot;</span>
   <span class="s2">&quot;my_key&quot;</span> <span class="o">:</span> <span class="s2">&quot;canopsis runs on myhostname&quot;</span>
   <span class="s2">&quot;my_list&quot;</span> <span class="o">:</span> <span class="p">[</span><span class="s2">&quot;canopsis runs on myhostname&quot;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is possible in json documents that the jsonloader will proceed to use a special macro that will replace record string in</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../best-practices/index.html" class="btn btn-neutral float-right" title="Best practices" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="engines/datacleaner-configuration.html" class="btn btn-neutral" title="Data cleaner" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Capensis.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>